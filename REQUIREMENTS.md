# トリンクシーのふたり診断 - 要件定義書

## 1. プロジェクト概要

### 基本情報

- **プロジェクト名**: トリンクシーのふたり診断
- **キャッチコピー**: 「2人の音色、調べてみる？」
- **目的**: 科学的に性格を測定してMBTIレベルの精度で相性を診断するプラットフォームを作成し、幅広い診断サービスを展開する。
- **ターゲット**: 18-35歳の幅広い層（大学生、若手社会人、婚活層含む）
- **主な利用シーン**: 気になる人段階、付き合い始め〜数ヶ月、合コンや飲み会など複数人利用は将来的に対応

### ビジネスモデル

- 完全無料提供（エンタメ診断＋真面目診断）
- 収益化は広告収益、アフィリエイト、企業提携による順段階的対応（実装後に詳細計画）

## 2. 診断サービス構成

### 診断モジュール完全分離設計

- 各診断ごとに独立したモジュール, ページ, データ, ロジックで構成
- メタデータ管理による診断一覧自動生成・拡張性確保

### 現状と予定の診断モジュール

| 診断ID | 名称 | 質問数 | 所要時間 | 特徴 | パス |
|--------|------|--------|----------|------|------|
| compatibility-18 | エンタメ相性診断 | 18 | 約3分 | 気軽でバズりやすい診断 | /diagnoses/compatibility-18 |
| compatibility-54 | 真面目相性診断 | 54 | 約7〜8分 | MBTIレベルの精度 | /diagnoses/compatibility-54 |
| （将来の追加項目） | 飲み会向け診断他 | - | - | 追加予定 | /diagnoses/追加診断ID |

## 3. 性格測定軸とタイプ分類

### 3軸による性格測定

- **コミュニケーション軸**: 積極型 ↔ 受容型（3段階: 積極型、バランス型、受容型）
- **意思決定軸**: 論理型 ↔ 感情型（3段階: 論理型、ハイブリッド型、感情型）
- **関係構築軸**: リード型 ↔ 寄り添い型（3段階: リード型、対等型、寄り添い型）

### 27タイプの分類

- **3軸 × 3軸 × 3軸 = 27タイプ**
- 各ユーザーはこの27タイプのうち1つに分類される
- タイプコード: `{communication}_{decision}_{relationship}` 形式
  - 例: `積極型_論理型_リード型`, `受容型_感情型_寄り添い型` など

### タイプ命名規則

各タイプは3軸の組み合わせで命名される：
- コミュニケーション軸: 積極型 / バランス型 / 受容型
- 意思決定軸: 論理型 / ハイブリッド型 / 感情型
- 関係性軸: リード型 / 対等型 / 寄り添い型

例：
- `積極型_論理型_リード型`: 力強くリード、論理的で決断が早い
- `受容型_感情型_寄り添い型`: 深く共感、感情豊かで寄り添う
- `バランス型_ハイブリッド型_対等型`: 穏やか、状況に応じて変化

### スコア変換ロジック

各軸のスコア（-12 ～ +12）を3段階に分類：

#### コミュニケーション軸（axis1）
- **スコア > 3**: 積極型
- **スコア < -3**: 受容型
- **-3 ≤ スコア ≤ 3**: バランス型

#### 意思決定軸（axis2）
- **スコア > 3**: 論理型
- **スコア < -3**: 感情型
- **-3 ≤ スコア ≤ 3**: ハイブリッド型

#### 関係性軸（axis3）
- **スコア > 3**: リード型
- **スコア < -3**: 寄り添い型
- **-3 ≤ スコア ≤ 3**: 対等型

### タイプ判定ロジック

1. 各軸のスコアから特性を判定（上記のスコア変換ロジックを使用）
2. 3つの特性を組み合わせてタイプコードを生成: `{communication}_{decision}_{relationship}`
3. タイプコードから27タイプのデータを取得（`types.json`から）
4. データが存在しない場合は、タイプ名と説明を動的に生成

## 4. 相性判定ロジック

### 27タイプ × 27タイプ = 729パターンの相性判定

- **相性パターン数**: 27タイプ × 27タイプ = 729パターン
- **全て事前計算**: 729パターンは全て事前に計算してJSONまたはDBに保存し参照する形式
- **総合相性スコアの計算式**:

```
総合スコア = 0.3 × 軸1の相性 + 0.4 × 軸2の相性 + 0.3 × 軸3の相性
```

### 各軸の相性概念

- **軸1（コミュニケーション）**: 補完性重視（積極型と受容型など逆の極が良い）
- **軸2（意思決定）**: 類似性重視（同じタイプ同士が良い）
- **軸3（関係性）**: 補完性重視（リード型と寄り添い型など逆の極が良い）

### 相性データの保存形式

- **JSON形式**: `compatibility.json` に全729パターンを保存
- **キー形式**: `{type1}_{type2}`（順序を考慮、例: `積極型_論理型_リード型_受容型_感情型_寄り添い型`）
- **データ構造**: 各パターンに以下を含む
  - `total`: 総合相性スコア（0-100）
  - `message`: 相性メッセージ
  - `detail`: 詳細説明
  - `adviceUser`: ユーザーへのアドバイス
  - `advicePartner`: 相手へのアドバイス

### 相性スコア計算ロジック（詳細）

#### 各軸の相性スコア計算

**軸1（コミュニケーション）: 補完性重視**
- 積極型 × 受容型: 100点
- 積極型 × バランス型 / 受容型 × バランス型: 70点
- 積極型 × 積極型 / 受容型 × 受容型: 50点
- バランス型 × バランス型: 80点

**軸2（意思決定）: 類似性重視**
- 同じタイプ同士: 100点
- ハイブリッド型を含む組み合わせ: 80点
- 論理型 × 感情型: 40点
- その他: 60点

**軸3（関係性）: 補完性重視**
- リード型 × 寄り添い型: 100点
- リード型 × 対等型 / 寄り添い型 × 対等型: 70点
- リード型 × リード型 / 寄り添い型 × 寄り添い型: 50点
- 対等型 × 対等型: 80点

#### 総合スコア計算式

```
総合スコア = 0.3 × 軸1の相性 + 0.4 × 軸2の相性 + 0.3 × 軸3の相性
```

表示する相性スコアは単一総合スコア（0-100）

## 5. 技術スタック

- **フロントエンド**: Next.js 14（App Router）、TypeScript
- **スタイリング**: Tailwind CSS、shadcn/ui
- **バックエンド**: Next.js API Routes（サーバーレス）
- **データベース**: Vercel Postgres（PostgreSQL）
- **ホスティング**: Vercel
- **開発環境**: Cursor

## 6. デザイン仕様

- **カラー**: ネイビー（#2C3E50）、ゴールド（#F39C12）、ホワイト
- **フォント**: LINE Seed JP（日本語）、Montserrat（英語）
- **シンプル、モダン、スマホファースト、スクショ映え重視**

## 7. ディレクトリ構造

```
pairly-lab/
├── REQUIREMENTS.md                 ※このドキュメント
├── docs/                          ※詳細ドキュメント保管用
├── app/
│   ├── page.tsx                   ※トップページ
│   ├── diagnoses/
│   │   ├── page.tsx               ※診断一覧ページ
│   │   ├── compatibility-18/
│   │   │   ├── page.tsx
│   │   │   ├── [step]/page.tsx
│   │   │   └── result/page.tsx
│   │   ├── compatibility-54/
│   │   │   ├── page.tsx
│   │   │   ├── [step]/page.tsx
│   │   │   └── result/page.tsx
│   │   └── ...                    ※今後追加診断
│   └── api/                      ※APIエンドポイント群
├── components/
│   ├── diagnoses/                 ※診断共通UI
│   ├── common/                    ※共通UI
│   └── ui/                       ※shadcn/ui関連
├── lib/
│   ├── diagnoses/                 ※診断ロジック
│   ├── common/                   ※共通処理、型定義
│   └── db.ts                     ※DB接続
├── data/
│   ├── diagnoses/
│   │   ├── compatibility-18/
│   │   ├── compatibility-54/
│   │   └── ...                   ※診断ごとのデータ
│   └── diagnoses-metadata.json    ※診断一覧メタデータ管理
├── public/
│   └── images/
```

## 8. 事前計算・ハイブリッド設計

- **18問エンタメ診断**: フロントエンドでJSON参照による計算（約1-3 MBの事前計算データ）
- **54問真面目診断**: サーバ側DB参照で高速計算（約390,000パターン事前計算）

## 9. 開発・運用ルール

- 要件は必ずREQUIREMENTS.mdで管理しGitで履歴を残す
- 実装はCursorに投げる前に要件を必ず参照
- 仕様変更があればREQUIREMENTS.md更新必須
- 型安全、テスト、高速化優先

## 10. 今後の展望

フェーズ2以降で「複数人診断」「新診断追加」「企業提携」「収益化プラン」など拡張検討

